AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  RoleName:
    Type: String
    Description: "Enter the name of the IAM Role"

Resources:
  # SNS Topic for sending notifications
  SNSTopic:
    Type: "AWS::SNS::Topic"
    Properties:
      Subscription:
        - Protocol: "email"
          Endpoint: "ndoropoulos@yahoo.com"

  # SNS Topic Policy to allow CloudFormation to publish messages
  SNSTopicPolicy:
    Type: "AWS::SNS::TopicPolicy"
    Properties:
      Topics: 
        - !Ref SNSTopic
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: "Allow"
            Principal:
              Service: "cloudformation.amazonaws.com"
            Action: "sns:Publish"
            Resource: !Ref SNSTopic

  # IAM Role with AdministratorAccess
  AdminRole:
    Type: "AWS::IAM::Role"
    Properties: 
      RoleName: !Ref RoleName
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: "Allow"
            Principal:
              AWS: "arn:aws:iam::713881813970:role/NicholasFiverrRole"
            Action: "sts:AssumeRole"
      ManagedPolicyArns:
        - "arn:aws:iam::aws:policy/AdministratorAccess"

Outputs:
  Notification:
    Description: "An email notification will be sent upon stack completion."
    Value: !Ref SNSTopic

  AdminRoleName:
    Description: "The name of the created IAM Role"
    Value: !Ref AdminRole
